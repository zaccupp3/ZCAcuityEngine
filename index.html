<!-- CHECKPOINT: Jan 20, 2026 - Work Saved -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title> Zac Cupp - Acuity Engine </title>
  <link rel="stylesheet" href="style.css" />

  <!-- ‚úÖ Staffing Details v2 layout helpers (safe, scoped) -->
  <style>
    /* Only affects the Staffing Details tab layout */
    .staffing-two-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      align-items: start;
    }

    @media (max-width: 980px) {
      .staffing-two-column {
        grid-template-columns: 1fr;
      }
    }

    .staffing-col h2 { margin-top: 0; }

    .leadership-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      align-items: end;
      margin-bottom: 12px;
    }

    @media (max-width: 980px) {
      .leadership-row { grid-template-columns: 1fr; }
    }

    .leadership-field label {
      display: block;
      font-weight: 800;
      font-size: 12px;
      opacity: 0.85;
      margin-bottom: 6px;
    }

    .leadership-field input {
      width: 100%;
      box-sizing: border-box;
    }

    .totals-block {
      margin-bottom: 12px;
      padding: 12px;
      border: 1px solid rgba(15, 23, 42, 0.12);
      border-radius: 14px;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    .totals-title {
      font-weight: 900;
      margin-bottom: 10px;
    }

    .totals-row {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 10px;
      align-items: center;
      margin: 8px 0;
    }

    @media (max-width: 980px) {
      .totals-row { grid-template-columns: 1fr; }
    }

    .totals-row select, .totals-row button {
      width: 100%;
      box-sizing: border-box;
    }

    .totals-row .totals-label {
      font-weight: 800;
      font-size: 12px;
      opacity: 0.85;
      white-space: nowrap;
    }
  </style>
</head>
<body>

  <!-- =====================================================
       FULL-PAGE AUTH GATE (Login first / Demo option)
  ===================================================== -->
  <div id="authGate" class="auth-gate">
    <div class="auth-card">
      <div class="auth-brand">
        <div class="auth-brand-dot"></div>
        <div>
          <div class="auth-title">Welcome Back!</div>
          <div class="auth-subtitle">Sign in to your account</div>
        </div>
      </div>

      <div class="auth-form">
        <label class="auth-field">
          <div class="auth-label">Your Email</div>
          <input id="authEmail" class="auth-input" type="email" placeholder="name@email.com" autocomplete="email" />
        </label>

        <label class="auth-field">
          <div class="auth-label">Password</div>
          <div class="auth-password-wrap">
            <input id="authPassword" class="auth-input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
            <button id="authTogglePw" class="auth-eye" type="button" aria-label="Toggle password">üëÅ</button>
          </div>
        </label>

        <div class="auth-row">
          <label class="auth-remember">
            <input id="authRemember" type="checkbox" checked />
            <span>Remember Me</span>
          </label>

          <button id="authForgot" class="auth-link" type="button">Forgot Password?</button>
        </div>

        <button id="authLoginBtn" class="auth-primary" type="button">Login</button>

        <div class="auth-divider">
          <span>or</span>
        </div>

        <button id="authDemoBtn" class="auth-secondary" type="button">Demo Environment</button>

        <div id="authGateMsg" class="auth-msg"></div>
      </div>
    </div>
  </div>

  <!-- =====================================================
       BOOT LOADER OVERLAY (step-based percent)
       - Shows while memberships/unit_state/realtime/render complete
       - Driven by app/app.init.js
  ===================================================== -->
  <div id="bootLoader" style="
    position:fixed; inset:0; z-index:10000;
    background:rgba(255,255,255,0.92);
    display:none; align-items:center; justify-content:center;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  ">
    <div style="
      width:min(520px,92vw);
      padding:18px;
      border-radius:16px;
      border:1px solid rgba(15,23,42,0.12);
      background:#fff;
      box-shadow:0 10px 30px rgba(0,0,0,0.12);
    ">
      <div style="font-weight:800; font-size:14px; color:#0f172a;">Loading unit‚Ä¶</div>
      <div id="bootLoaderMsg" style="margin-top:6px; font-size:12px; color:#475569;">Starting‚Ä¶</div>

      <div style="margin-top:12px; height:10px; background:#e2e8f0; border-radius:999px; overflow:hidden;">
        <div id="bootLoaderBar" style="height:100%; width:0%; background:#3b82f6; transition:width 180ms ease;"></div>
      </div>

      <div id="bootLoaderPct" style="margin-top:8px; font-size:12px; color:#64748b; text-align:right;">0%</div>
    </div>
  </div>

  <!-- Top Header / Nav -->
  <header class="app-header">
    <!-- Left: Brand -->
    <div class="app-header-left">
      <div class="brand">
        <span class="brand-dot" aria-hidden="true"></span>
        <span class="brand-text">
          <span class="brand-title">Acuity Engine & Workforce Optimizer</span>
          <span class="brand-subtitle">Created by Zachary Cupp, BSN, RN</span>
        </span>
      </div>
    </div>

    <!-- Middle: Tabs -->
    <nav class="header-nav top-tabs" aria-label="Primary">
      <button class="tabButton header-tab" data-target="staffingTab">Staffing Details</button>
      <button class="tabButton header-tab" data-target="patientDetailsTab">Patient Details</button>
      <button class="tabButton header-tab" data-target="liveAssignmentTab">LIVE Assignment</button>
      <button class="tabButton header-tab" data-target="oncomingAssignmentTab">Oncoming Assignment</button>
      <button class="tabButton header-tab" data-target="highRiskTab">High Risk Report</button>
      <button class="tabButton header-tab" data-target="unitPulseTab">Unit Pulse</button>
      <button class="tabButton header-tab" data-target="unitMetricsTab">Unit Metrics</button>
    </nav>

    <!-- Right: Unit Switch + Compact Auth Menu -->
    <div class="header-right">
      <div class="unit-switcher" style="display:flex; align-items:center; gap:8px; margin-right:10px;">
        <span style="font-size:12px; opacity:0.75;">Unit</span>
        <select id="unitSwitcher" style="max-width:220px;">
          <option value="">‚Äî</option>
        </select>
      </div>

      <div id="authMenu" class="auth-menu">
        <button id="authMenuBtn" class="auth-menu-btn" type="button" aria-haspopup="menu" aria-expanded="false" title="Account">
          <span class="auth-avatar" aria-hidden="true">üë§</span>
        </button>

        <div id="authDropdown" class="auth-dropdown" role="menu" aria-label="Account menu">
          <div class="auth-dropdown-header">
            <div id="authStatus" class="auth-status">Auth: ‚Ä¶</div>
            <button id="authDropdownClose" class="auth-x" type="button" aria-label="Close">‚úï</button>
          </div>

          <!-- Signed out -->
          <div id="authLoggedOut" class="auth-block" style="display:none;">
            <label class="auth-label" for="authMenuEmail">Email</label>
            <input id="authMenuEmail" type="email" placeholder="you@domain.com" class="auth-input">

            <label class="auth-label" for="authMenuPassword" style="margin-top:8px;">Password</label>
            <input id="authMenuPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="auth-input" autocomplete="current-password">

            <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
              <button id="btnSignInPassword" class="auth-primary-btn" type="button">Sign in</button>
              <button id="btnSignUpPassword" class="auth-secondary-btn" type="button">Sign up</button>
              <button id="btnMagicLink" class="auth-ghost-btn" type="button">Magic link</button>
            </div>

            <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
              <button id="btnResetPassword" class="auth-ghost-btn" type="button">Set / Reset password</button>
            </div>

            <div style="margin-top:8px; font-size:12px; opacity:0.75; line-height:1.3;">
              Tip: If you originally used magic link, click <strong>Set / Reset password</strong> once to create a password for the same account.
            </div>
          </div>

          <!-- ‚úÖ Password Recovery / Set New Password -->
          <div id="authRecovery" class="auth-block" style="display:none; margin-top:10px;">
            <div style="font-weight:800; font-size:13px; color:#0f172a;">Set New Password</div>

            <label class="auth-label" for="authNewPassword">New password</label>
            <input id="authNewPassword" type="password" class="auth-input" placeholder="At least 8 characters" autocomplete="new-password">

            <label class="auth-label" for="authNewPassword2">Confirm new password</label>
            <input id="authNewPassword2" type="password" class="auth-input" placeholder="Repeat your password" autocomplete="new-password">

            <button id="btnSetNewPassword" class="auth-primary-btn" type="button">Save new password</button>

            <div style="font-size:12px; opacity:0.75; line-height:1.3;">
              After saving, you can sign in normally using email + password.
            </div>
          </div>

          <!-- Signed in -->
          <div id="authLoggedIn" class="auth-block" style="display:none;">
            <div class="auth-userline">
              <div class="auth-useremail" id="authUserEmail"></div>
              <div class="auth-pill" id="authUnitRole">unit: ‚Äî | role: ‚Äî</div>
            </div>
            <button id="btnSignOut" class="auth-danger-btn" type="button">Sign out</button>
          </div>

          <div id="authMsg" class="auth-msg"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- ‚úÖ GLOBAL TOP-RIGHT UTILITY ZONE (NOT IN TABS) -->
  <div id="globalTopRightTools" style="
    width:100%;
    display:flex;
    justify-content:flex-end;
    padding: 18px 18px 0 18px;
    box-sizing:border-box;
    pointer-events:none;
  ">
    <div id="globalDischargeBinHost" style="
      width: 280px;
      pointer-events:auto;
    "></div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="main-container">

    <!-- STAFFING TAB -->
    <section id="staffingTab" class="tab-section" style="display: block;">
      <h1>Staffing Details</h1>

      <!-- ‚úÖ Staffing Details v2 -->
      <div class="staffing-two-column" data-staffing-layout="v2">

        <!-- CURRENT SHIFT COLUMN -->
        <div class="staffing-col">
          <h2>Current Shift</h2>

          <div class="totals-block">
            <div class="totals-title">Leadership Team</div>
            <div class="leadership-row">
              <div class="leadership-field">
                <label for="currentChargeName">Charge</label>
                <input id="currentChargeName" type="text" placeholder="Name" />
              </div>
              <div class="leadership-field">
                <label for="currentMentorName">Resource / Clinical Mentor</label>
                <input id="currentMentorName" type="text" placeholder="Name" />
              </div>
              <div class="leadership-field">
                <label for="currentCtaName">CTA</label>
                <input id="currentCtaName" type="text" placeholder="Name" />
              </div>
            </div>
          </div>

          <div class="totals-block">
            <div class="totals-title">Staffing Totals</div>

            <div class="totals-row">
              <div class="totals-label">Total RNs</div>
              <select id="currentNurseCount">
                <option>1</option><option>2</option><option>3</option><option>4</option>
                <option>5</option><option>6</option><option>7</option><option>8</option>
                <option>9</option><option>10</option>
              </select>
              <button type="button" onclick="setupCurrentNurses()">Update Current RNs</button>
            </div>

            <div class="totals-row">
              <div class="totals-label">Total PCAs</div>
              <select id="currentPcaCount">
                <option>1</option><option>2</option><option>3</option>
                <option>4</option><option>5</option><option>6</option><option>7</option>
              </select>
              <button type="button" onclick="setupCurrentPcas()">Update Current PCAs</button>
            </div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Current RNs</div>
            <div class="staff-subtitle">Current RN List</div>
            <div id="currentNurseList" class="staffList"></div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Current PCAs</div>
            <div class="staff-subtitle">Current PCA List</div>
            <div id="currentPcaList" class="staffList"></div>
          </div>
        </div>

        <!-- ONCOMING SHIFT COLUMN -->
        <div class="staffing-col">
          <h2>Oncoming Shift</h2>

          <div class="totals-block">
            <div class="totals-title">Leadership Team</div>
            <div class="leadership-row">
              <div class="leadership-field">
                <label for="incomingChargeName">Charge</label>
                <input id="incomingChargeName" type="text" placeholder="Name" />
              </div>
              <div class="leadership-field">
                <label for="incomingMentorName">Resource / Clinical Mentor</label>
                <input id="incomingMentorName" type="text" placeholder="Name" />
              </div>
              <div class="leadership-field">
                <label for="incomingCtaName">CTA</label>
                <input id="incomingCtaName" type="text" placeholder="Name" />
              </div>
            </div>
          </div>

          <div class="totals-block">
            <div class="totals-title">Staffing Totals</div>

            <div class="totals-row">
              <div class="totals-label">Total RNs</div>
              <select id="incomingNurseCount">
                <option>1</option><option>2</option><option>3</option><option>4</option>
                <option>5</option><option>6</option><option>7</option><option>8</option>
                <option>9</option><option>10</option>
              </select>
              <button type="button" onclick="setupIncomingNurses()">Update Oncoming RNs</button>
            </div>

            <div class="totals-row">
              <div class="totals-label">Total PCAs</div>
              <select id="incomingPcaCount">
                <option>1</option><option>2</option><option>3</option>
                <option>4</option><option>5</option><option>6</option><option>7</option>
              </select>
              <button type="button" onclick="setupIncomingPcas()">Update Oncoming PCAs</button>
            </div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Oncoming RNs</div>
            <div class="staff-subtitle">Oncoming RN List</div>
            <div id="incomingNurseList" class="staffList"></div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Oncoming PCAs</div>
            <div class="staff-subtitle">Oncoming PCA List</div>
            <div id="incomingPcaList" class="staffList"></div>
          </div>
        </div>

      </div>
    </section>

    <!-- PATIENT DETAILS TAB -->
    <section id="patientDetailsTab" class="tab-section" style="display: none;">
      <h1>Patient Details</h1>
      <p>
        This grid shows all 32 rooms. Use the controls to set acuity tags and gender
        for each patient. These tags feed both the LIVE and Oncoming Assignment engines.
      </p>

      <div class="actions-row">
        <button type="button" onclick="window.activateAllRooms && window.activateAllRooms()">Add All Rooms</button>
        <button type="button" onclick="window.emptyAllRooms && window.emptyAllRooms()">Empty All Rooms</button>
      </div>

      <div id="patientList" class="patient-grid"></div>
    </section>

    <!-- HIGH RISK TAB -->
    <section id="highRiskTab" class="tab-section" style="display: none;">
      <h1>High Risk Report</h1>
      <p>
        Summary of key acuity tags across all active patients. Use this for quick
        situational awareness and handoff.
      </p>

      <div class="actions-row">
        <button onclick="updateAcuityTiles()">Refresh High Risk Report</button>
        <button onclick="openAcuityModal()">Open Full Acuity Modal</button>
      </div>

      <div id="acuityTiles" class="acuity-tiles-container"></div>
    </section>

    <!-- LIVE ASSIGNMENT TAB -->
    <section id="liveAssignmentTab" class="tab-section" style="display: none;">
      <h1>Live Assignment</h1>

      <div class="actions-row">
        <button onclick="window.populateLiveAssignment(false)">Populate Live Assignment</button>

        <button type="button" onclick="window.openImportAssignmentScan && window.openImportAssignmentScan()">
          Import Assignment to LIVE (Photo)
        </button>
      </div>

      <!-- ‚úÖ Option A: remove the legacy Admit Queue column.
           LIVE injects the horizontal Admit Queue inline above RN tiles. -->
      <div class="live-layout live-layout--rn-only">
        <div class="live-column">
          <h2>Current RN Assignments</h2>
          <div id="liveNurseAssignments" class="assignment-grid live-grid live-grid-nurse"></div>
        </div>
      </div>

      <div class="live-layout live-layout--pca-only" style="margin-top: 16px;">
        <div class="live-column">
          <h2>Current PCA Assignments</h2>
          <div id="livePcaAssignments" class="assignment-grid live-grid live-grid-pca"></div>
        </div>
      </div>
    </section>

    <!-- ONCOMING ASSIGNMENT TAB -->
    <section id="oncomingAssignmentTab" class="tab-section" style="display: none;">
      <h1>Oncoming Assignment (Incoming Staff)</h1>

      <div class="actions-row" style="flex-wrap:wrap;">
        <button onclick="window.populateOncomingAssignment && window.populateOncomingAssignment(false)">Populate Oncoming Assignment</button>

        <button id="btnPrintOncoming" type="button"
                onclick="window.printOncoming && window.printOncoming.open()">
          Print Oncoming (1-page)
        </button>

        <button type="button" onclick="window.rebalanceOncomingRnOnly && window.rebalanceOncomingRnOnly()">Rebalance RN (Only)</button>
        <button type="button" onclick="window.rebalanceOncomingPcaOnly && window.rebalanceOncomingPcaOnly()">Rebalance PCA (Only)</button>

        <button onclick="window.rebalanceOncomingAssignment && window.rebalanceOncomingAssignment()">Rebalance (Both)</button>

        <button id="btnFinalizeShift" type="button" title="Publishes Oncoming snapshot + analytics, then swaps Live ‚Üê Oncoming">
          Finalize / Submit Shift Change
        </button>
      </div>

      <div class="staff-card" style="margin-top: 12px;">
        <div class="staff-card-header">Finalize Details</div>
        <div class="staff-inline-controls" style="gap:10px; flex-wrap:wrap;">
          <label for="finalizeShiftDate"><strong>Shift date:</strong></label>
          <input id="finalizeShiftDate" type="date" />

          <label for="finalizeShiftType"><strong>Shift type:</strong></label>
          <select id="finalizeShiftType">
            <option value="day">Day</option>
            <option value="night">Night</option>
          </select>

          <div style="font-size:12px; opacity:0.75;">
            (Charge/Admin/Owner only)
          </div>
        </div>

        <div id="finalizeStatusMsg" style="margin-top:10px; font-size:12px; opacity:0.85;"></div>
      </div>

      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top: 12px;">
        <h2 style="margin:0;">Incoming RN Assignments</h2>
        <button type="button" onclick="window.rebalanceOncomingRnOnly && window.rebalanceOncomingRnOnly()">
          Rebalance RN
        </button>
      </div>
      <div id="assignmentOutput" class="assignment-grid two-column-grid"></div>

      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top: 24px;">
        <h2 style="margin:0;">Incoming PCA Assignments</h2>
        <button type="button" onclick="window.rebalanceOncomingPcaOnly && window.rebalanceOncomingPcaOnly()">
          Rebalance PCA
        </button>
      </div>
      <div id="pcaAssignmentOutput" class="assignment-grid two-column-grid"></div>
    </section>

    <!-- ‚úÖ UNIT PULSE TAB -->
    <section id="unitPulseTab" class="tab-section" style="display: none;">
      <h1>Unit Pulse</h1>
      <p>
        Live, shift-specific workload pulse (time-windowed). Staff list is driven by current RN/PCA assignments.
      </p>

      <div id="unitPulseRoot"></div>
    </section>

    <!-- ‚úÖ UNIT METRICS TAB -->
    <section id="unitMetricsTab" class="tab-section" style="display: none;">
      <h1>Unit Metrics</h1>
      <p>
        Pulls unit-scoped shift metrics from Supabase and displays trends (historic).
      </p>

      <div class="staff-card">
        <div class="staff-card-header">Query Controls</div>

        <div class="staff-inline-controls" style="gap:10px; flex-wrap:wrap;">
          <label for="pulseFrom"><strong>From:</strong></label>
          <input id="pulseFrom" type="date" />

          <label for="pulseTo"><strong>To:</strong></label>
          <input id="pulseTo" type="date" />

          <label for="pulseShiftType"><strong>Shift:</strong></label>
          <select id="pulseShiftType">
            <option value="">All</option>
            <option value="day">Day</option>
            <option value="night">Night</option>
          </select>

          <button id="btnLoadPulse" type="button">Load Metrics</button>
        </div>

        <div id="pulseStatusMsg" style="margin-top:10px; font-size:12px; opacity:0.85;"></div>
      </div>

      <div class="staff-card">
        <div class="staff-card-header">Metrics Summary</div>
        <div id="pulseSummary" style="font-size:14px; color:#475569; line-height:1.4;">
          No data loaded yet.
        </div>
      </div>

      <div class="staff-card">
        <div class="staff-card-header">Metrics (Table)</div>
        <div id="pulseTable" style="overflow:auto;"></div>
      </div>
    </section>

  </main>

  <!-- MODALS (unchanged) -->
  <div id="patientProfileModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="profileModalTitle">Patient Profile</span>
        <button class="close-btn" onclick="closePatientProfileModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-row">
          <label for="profGender"><strong>Gender:</strong></label>
          <select id="profGender">
            <option value="">-</option>
            <option value="F">F</option>
            <option value="M">M</option>
            <option value="X">X</option>
          </select>
        </div>

        <div class="modal-grid">
          <div class="modal-column">
            <h3>RN Acuity Tags</h3>
            <label><input type="checkbox" id="profTele" /> Tele</label>
            <label><input type="checkbox" id="profDrip" /> Drip</label>
            <label><input type="checkbox" id="profNih" /> NIH</label>
            <label><input type="checkbox" id="profBg" /> BG</label>
            <label><input type="checkbox" id="profCiwa" /> CIWA/COWS</label>
            <label><input type="checkbox" id="profRestraint" /> Restraint</label>
            <label><input type="checkbox" id="profSitter" /> Sitter</label>
            <label><input type="checkbox" id="profVpo" /> VPO</label>
            <label><input type="checkbox" id="profIso" /> Isolation</label>
            <label><input type="checkbox" id="profAdmit" /> Admit</label>
            <label><input type="checkbox" id="profLateDc" /> Late DC</label>
          </div>

          <div class="modal-column">
            <h3>PCA Acuity Tags</h3>
            <label><input type="checkbox" id="profTelePca" /> Tele</label>
            <label><input type="checkbox" id="profIsoPca" /> Isolation</label>
            <label><input type="checkbox" id="profAdmitPca" /> Admit</label>
            <label><input type="checkbox" id="profLateDcPca" /> Late DC</label>
            <label><input type="checkbox" id="profChg" /> CHG</label>
            <label><input type="checkbox" id="profFoley" /> Foley</label>
            <label><input type="checkbox" id="profQ2" /> Q2 Turns</label>
            <label><input type="checkbox" id="profHeavy" /> Heavy</label>
            <label><input type="checkbox" id="profFeeder" /> Feeder</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="savePatientProfile()">Save</button>
        <button onclick="closePatientProfileModal()">Cancel</button>
      </div>
    </div>
  </div>

  <div id="dischargeHistoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>Discharge History (This Session)</span>
        <button class="close-btn" onclick="closeDischargeHistoryModal()">&times;</button>
      </div>
      <div class="modal-body" id="dischargeHistoryBody"></div>
    </div>
  </div>

  <div id="acuityModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>High Acuity Summary</span>
        <button class="close-btn" onclick="closeAcuityModal()">&times;</button>
      </div>
      <div class="modal-body" id="acuityReportBody"></div>
    </div>
  </div>

  <div id="queueAssignModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>Assign Admit to RN / PCA</span>
        <button class="close-btn" onclick="closeQueueAssignModal()">&times;</button>
      </div>

      <div class="modal-body">
        <p id="queueAssignInfo" style="margin-bottom: 12px; font-size: 14px; opacity: 0.8;">
          Select the receiving RN, PCA, and the empty bed for this admit.
        </p>

        <div class="modal-row">
          <label for="queueAssignBed"><strong>Receiving Bed (Empty):</strong></label>
          <select id="queueAssignBed"></select>
        </div>

        <div class="modal-row">
          <label for="queueAssignNurse"><strong>Receiving RN:</strong></label>
          <select id="queueAssignNurse"></select>
        </div>

        <div class="modal-row">
          <label for="queueAssignPca"><strong>Receiving PCA:</strong></label>
          <select id="queueAssignPca"></select>
        </div>

        <p style="font-size: 12px; opacity: 0.7; margin-top: 8px;">
          Tip: if you don‚Äôt see the bed you expect, make sure the room is marked empty in Patient Details or by discharge.
        </p>
      </div>

      <div class="modal-footer">
        <button onclick="confirmQueueAssign()">Assign</button>
        <button onclick="closeQueueAssignModal()">Cancel</button>
      </div>
    </div>
  </div>

  <div id="admitDraftModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="admitDraftTitle">Pre-Admit Tags</span>
        <button class="close-btn" onclick="closeAdmitDraftModal()">&times;</button>
      </div>

      <div class="modal-body">
        <p id="admitDraftInfo" style="margin-bottom: 12px; font-size: 14px; opacity: 0.85;">
          Set optional pre-admit tags. These will copy into the patient record when you assign this admit into a bed.
        </p>

        <div class="modal-row">
          <label for="admitDraftGender"><strong>Gender (optional):</strong></label>
          <select id="admitDraftGender">
            <option value="">-</option>
            <option value="F">F</option>
            <option value="M">M</option>
            <option value="X">X</option>
          </select>
        </div>

        <div class="modal-grid" style="margin-top: 12px;">
          <div class="modal-column">
            <h3>RN Pre-Admit Tags</h3>
            <label><input type="checkbox" id="adTele" /> Tele</label>
            <label><input type="checkbox" id="adDrip" /> Drip</label>
            <label><input type="checkbox" id="adNih" /> NIH</label>
            <label><input type="checkbox" id="adBg" /> BG</label>
            <label><input type="checkbox" id="adCiwa" /> CIWA/COWS</label>
            <label><input type="checkbox" id="adRestraint" /> Restraint</label>
            <label><input type="checkbox" id="adSitter" /> Sitter</label>
            <label><input type="checkbox" id="adVpo" /> VPO</label>
            <label><input type="checkbox" id="adIso" /> Isolation</label>
            <label><input type="checkbox" id="adLateDc" /> Late DC</label>
          </div>

          <div class="modal-column">
            <h3>PCA Pre-Admit Tags</h3>
            <label><input type="checkbox" id="adChg" /> CHG</label>
            <label><input type="checkbox" id="adFoley" /> Foley</label>
            <label><input type="checkbox" id="adQ2" /> Q2 Turns</label>
            <label><input type="checkbox" id="adHeavy" /> Heavy</label>
            <label><input type="checkbox" id="adFeeder" /> Feeder</label>
          </div>
        </div>

        <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
          Note: ‚ÄúAdmit‚Äù itself is automatically set when the admit is placed into a bed.
        </p>
      </div>

      <div class="modal-footer">
        <button onclick="saveAdmitDraftFromModal()">Save Tags</button>
        <button onclick="closeAdmitDraftModal()">Cancel</button>
      </div>
    </div>
  </div>

  <div id="staffingWarnModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width:560px;">
      <div class="modal-header">
        <span id="staffingWarnTitle">Unable to lower staffing</span>
        <button class="close-btn" type="button" onclick="window.closeStaffingWarnModal && window.closeStaffingWarnModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="staffingWarnBody" style="font-size:14px; opacity:0.9; line-height:1.45;"></div>
      </div>
      <div class="modal-footer">
        <button type="button" onclick="window.closeStaffingWarnModal && window.closeStaffingWarnModal()">OK</button>
      </div>
    </div>
  </div>

    <!-- =====================================================
         ‚úÖ SCRIPT ORDER FIX (cache-busters updated)
    ===================================================== -->

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

    <script src="app/app.supabaseConfig.js?v=1"></script>
    <script src="app/app.supabase.js?v=1"></script>
    <script src="app/app.authGate.js?v=14"></script>
    <script src="app/app.authUI.js?v=14"></script>

    <script src="app/app.state.js?v=1"></script>
    <script src="app/app.init.js?v=1"></script>

    <!-- ‚úÖ Shift Log + Narrative (facts layer first, then report/UI) -->
    <script src="app/app.shiftLog.js?v=1"></script>
    <script src="app/app.shiftReport.js?v=1"></script>

    <script src="app/app.queue.js?v=1"></script>
    <script src="app/app.staffing.js?v=8"></script>
    <script src="app/app.patientsAcuity.js?v=2"></script>

    <script src="app/app.assignmentRules.js?v=4"></script>

    <script src="app/app.admitQueue.js?v=2"></script>
    <script src="app/app.liveAssignments.js?v=96"></script>
    <script src="app/app.assignmentsrender.js?v=4"></script>
    <script src="app/app.assignmentsDrag.js?v=1"></script>

    <script src="app/app.modals.js?v=1"></script>
    <script src="app/app.patientProfileUI.js?v=909"></script>

    <script src="app/app.shiftChange.js?v=1"></script>

    <script src="app/app.unitMetrics.js?v=1"></script>
    <script src="app/app.unitPulse.js?v=5"></script>

    <script src="app/app.printOncoming.js?v=8"></script>
    <script src="app/app.printLive.js?v=8"></script>

    <script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>

    <script type="module">
      import * as pdfjsLib from "./vendor/pdfjs/pdf.min.mjs";
      window.pdfjsLib = pdfjsLib;
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "./vendor/pdfjs/pdf.worker.min.mjs";
      console.log("[PDF] pdfjsLib loaded (local ES module)", pdfjsLib.version);
    </script>

    <script src="app/app.scanPdf.js?v=9"></script>

    <script src="app/app.csvNormalizer.js?v=16"></script>
    <script src="app/app.importCsv.js?v=2"></script>

    <script src="app/app.scanOcr.js?v=99"></script>
    <script src="app/app.scanParserTemplateV2.js?v=102"></script>
    <script src="app/app.scanReviewApply.js?v=110"></script>
    <script src="app/app.importScan.js?v=100"></script>

    <script src="script.js?v=1"></script>
  </body>
  </html>