<!-- CHECKPOINT: Dec 4, 2025 - Work Saved -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cupp Health Solutions – Assignment Engine</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Top Header / Nav -->
  <header class="app-header">
    <div class="header-left">
      <span class="logo-dot"></span>
      <span class="header-title">
        Cupp Health Solutions: Assignment Engine - Created by Zachary Cupp, BSN, RN
      </span>
    </div>

    <!-- Supabase Auth Status -->
    <div id="authPanel" style="padding:12px;border:1px solid #ddd;border-radius:10px;margin:10px 0;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
      <div id="authStatus" style="font-weight:600;">Auth: …</div>

      <div id="authLoggedOut" style="display:none;gap:8px;align-items:center;">
        <input id="authEmail" type="email" placeholder="you@domain.com" style="padding:8px;border:1px solid #ccc;border-radius:8px;min-width:240px;">
        <button id="btnMagicLink" style="padding:8px 12px;border:0;border-radius:8px;cursor:pointer;">Send magic link</button>
      </div>

      <div id="authLoggedIn" style="display:none;gap:8px;align-items:center;">
        <span id="authUserEmail" style="opacity:.85;"></span>
        <span id="authUnitRole" style="padding:4px 8px;border-radius:999px;background:#f1f5f9;">unit: — | role: —</span>
        <button id="btnSignOut" style="padding:8px 12px;border:0;border-radius:8px;cursor:pointer;">Sign out</button>
      </div>

      <div id="authMsg" style="width:100%;opacity:.8;"></div>
    </div>

    <!-- Tabs moved into header (sticky) -->
    <nav class="header-nav" aria-label="Primary">
      <button class="tabButton active header-tab" data-target="staffingTab" onclick="showTab('staffingTab', this)">
        Staffing Details
      </button>
      <button class="tabButton header-tab" data-target="patientDetailsTab" onclick="showTab('patientDetailsTab', this)">
        Patient Details
      </button>
      <button class="tabButton header-tab" data-target="highRiskTab" onclick="showTab('highRiskTab', this)">
        High Risk Report
      </button>
      <button class="tabButton header-tab" data-target="liveAssignmentTab" onclick="showTab('liveAssignmentTab', this)">
        LIVE Assignment
      </button>
      <button class="tabButton header-tab" data-target="oncomingAssignmentTab" onclick="showTab('oncomingAssignmentTab', this)">
        Oncoming Assignment
      </button>
    </nav>

    <!-- Right side buttons removed per request -->
    <div class="header-right"></div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="main-container">

    <!-- STAFFING TAB -->
    <section id="staffingTab" class="tab-section" style="display: block;">
      <h1>Staffing Details</h1>

      <div class="staffing-three-column">
        <!-- LEFT COLUMN: Charge / Mentor / CTA -->
        <div class="staff-column staff-column--support">
          <h2>Support Roles</h2>

          <div class="staff-card">
            <div class="staff-card-header">Current Shift</div>

            <div class="staff-role-row">
              <label for="currentChargeName"><strong>Current Charge:</strong></label>
              <input id="currentChargeName" type="text" placeholder="Name" />
            </div>

            <div class="staff-role-row">
              <label for="currentMentorName"><strong>Current Clinical Mentor:</strong></label>
              <input id="currentMentorName" type="text" placeholder="Name" />
            </div>

            <div class="staff-role-row">
              <label for="currentCtaName"><strong>Current CTA:</strong></label>
              <input id="currentCtaName" type="text" placeholder="Name" />
            </div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Oncoming Shift</div>

            <div class="staff-role-row">
              <label for="incomingChargeName"><strong>Oncoming Charge:</strong></label>
              <input id="incomingChargeName" type="text" placeholder="Name" />
            </div>

            <div class="staff-role-row">
              <label for="incomingMentorName"><strong>Oncoming Clinical Mentor:</strong></label>
              <input id="incomingMentorName" type="text" placeholder="Name" />
            </div>

            <div class="staff-role-row">
              <label for="incomingCtaName"><strong>Oncoming CTA:</strong></label>
              <input id="incomingCtaName" type="text" placeholder="Name" />
            </div>
          </div>
        </div>

        <!-- MIDDLE COLUMN: Current Shift (existing) -->
        <div class="staff-column">
          <h2>Current Shift</h2>

          <div class="staff-card">
            <div class="staff-card-header">Current RNs</div>
            <div class="staff-inline-controls">
              <label for="currentNurseCount">Current RNs:</label>
              <select id="currentNurseCount">
                <option>1</option><option>2</option><option>3</option><option>4</option>
                <option>5</option><option>6</option><option>7</option><option>8</option>
              </select>
              <button onclick="setupCurrentNurses()">Update Current RNs</button>
            </div>
            <div class="staff-subtitle">Current RN List</div>
            <div id="currentNurseList" class="staffList"></div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Current PCAs</div>
            <div class="staff-inline-controls">
              <label for="pcaShift">PCA Shift:</label>
              <select id="pcaShift" onchange="updatePcaShift(this.value)">
                <option value="day">Day</option>
                <option value="night">Night</option>
              </select>

              <span>Current PCAs:</span>
              <select id="currentPcaCount">
                <option>1</option><option>2</option><option>3</option>
                <option>4</option><option>5</option><option>6</option>
              </select>
              <button onclick="setupCurrentPcas()">Update Current PCAs</button>
            </div>
            <div class="staff-subtitle">Current PCA List</div>
            <div id="currentPcaList" class="staffList"></div>
          </div>
        </div>

        <!-- RIGHT COLUMN: Oncoming Shift (existing) -->
        <div class="staff-column">
          <h2>Oncoming Shift</h2>

          <div class="staff-card">
            <div class="staff-card-header">Oncoming RNs</div>
            <div class="staff-inline-controls">
              <label for="incomingNurseCount">Oncoming RNs:</label>
              <select id="incomingNurseCount">
                <option>1</option><option>2</option><option>3</option><option>4</option>
                <option>5</option><option>6</option><option>7</option><option>8</option>
              </select>
              <button onclick="setupIncomingNurses()">Update Oncoming RNs</button>
            </div>
            <div class="staff-subtitle">Oncoming RN List</div>
            <div id="incomingNurseList" class="staffList"></div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Oncoming PCAs</div>
            <div class="staff-inline-controls">
              <label for="incomingPcaCount">Oncoming PCAs:</label>
              <select id="incomingPcaCount">
                <option>1</option><option>2</option><option>3</option>
                <option>4</option><option>5</option><option>6</option>
              </select>
              <button onclick="setupIncomingPcas()">Update Oncoming PCAs</button>
            </div>
            <div class="staff-subtitle">Oncoming PCA List</div>
            <div id="incomingPcaList" class="staffList"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- PATIENT DETAILS TAB -->
    <section id="patientDetailsTab" class="tab-section" style="display: none;">
      <h1>Patient Details</h1>
      <p>
        This grid shows all 32 rooms. Use the controls to set acuity tags and gender
        for each patient. These tags feed both the LIVE and Oncoming Assignment engines.
      </p>

      <div class="actions-row">
        <button onclick="renderPatientList()">Refresh Patient Grid</button>
        <button onclick="resetAllPatients()">Reset All Patients</button>
      </div>

      <div id="patientList" class="patient-grid"></div>
    </section>

    <!-- HIGH RISK TAB -->
    <section id="highRiskTab" class="tab-section" style="display: none;">
      <h1>High Risk Report</h1>
      <p>
        Summary of key acuity tags across all active patients. Use this for quick
        situational awareness and handoff.
      </p>

      <div class="actions-row">
        <button onclick="updateAcuityTiles()">Refresh High Risk Report</button>
        <button onclick="openAcuityModal()">Open Full Acuity Modal</button>
      </div>

      <div id="acuityTiles" class="acuity-tiles-container"></div>
    </section>

    <!-- LIVE ASSIGNMENT TAB -->
    <section id="liveAssignmentTab" class="tab-section" style="display: none;">
      <h1>Live Assignment</h1>

      <div class="actions-row">
        <button onclick="window.populateLiveAssignment(false)">Populate Live Assignment</button>
        <button onclick="window.populateLiveAssignment(true)">Randomize Live Assignment</button>
        <button onclick="clearRecentlyDischargedFlags()">Clear “Recently Discharged” Flags</button>
      </div>

      <div class="live-top-bar">
        <div class="discharge-bin">
          <strong>Discharge Bin:</strong>
          <span id="dischargeCount">0</span> recent this session
          <button onclick="openDischargeHistoryModal()">View History</button>
          <div
            id="dischargeDropZone"
            class="discharge-drop-zone"
            ondragover="onDischargeDragOver(event)"
            ondrop="onDischargeDrop(event)"
          >
            Drag here to discharge patient
          </div>
        </div>
      </div>

      <div class="live-layout">
        <div class="live-column">
          <h2>Current RN Assignments</h2>
          <div id="liveNurseAssignments" class="assignment-grid live-grid live-grid-nurse"></div>
        </div>

        <div class="live-column">
          <h2>Current PCA Assignments</h2>
          <div id="livePcaAssignments" class="assignment-grid live-grid live-grid-pca"></div>

          <h2 style="margin-top: 24px;">Admit Queue</h2>

          <div class="actions-row">
            <button onclick="promptAddAdmit()">+ Add Admit</button>
          </div>

          <div id="queueList" class="queue-list"></div>
        </div>
      </div>
    </section>

    <!-- ONCOMING ASSIGNMENT TAB -->
    <section id="oncomingAssignmentTab" class="tab-section" style="display: none;">
      <h1>Oncoming Assignment (Incoming Staff)</h1>

      <div class="actions-row">
        <button onclick="populateOncomingAssignment()">Populate Oncoming Assignment</button>
        <button onclick="rebalanceOncomingAssignment()">Re-generate / Rebalance</button>
      </div>

      <h2>Incoming RN Assignments</h2>
      <div id="assignmentOutput" class="assignment-grid two-column-grid"></div>

      <h2 style="margin-top: 24px;">Incoming PCA Assignments</h2>
      <div id="pcaAssignmentOutput" class="assignment-grid two-column-grid"></div>
    </section>
  </main>

  <!-- MODALS (same as before) -->
  <!-- ... your modals unchanged ... -->

  <script src="app/app.state.js"></script>
  <script src="app/app.queue.js"></script>
  <script src="app/app.staffing.js"></script>
  <script src="app/app.patientsAcuity.js"></script>
  <script src="app/app.assignmentsDrag.js"></script>
  <script src="app/app.assignmentRules.js"></script>

  <script src="app/app.liveAssignments.js"></script>
  <script src="app/app.assignmentsrender.js"></script>
  <script src="app/app.modals.js"></script>

  <script src="app/app.supabaseConfig.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="app/app.supabase.js"></script>
  <script src="app/app.authUI.js"></script>

  <script src="app/app.init.js"></script>
  <script src="script.js"></script>
</body>
</html>