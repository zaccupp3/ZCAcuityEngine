<!-- CHECKPOINT: Dec 4, 2025 - Work Saved -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cupp Health Solutions ‚Äì Assignment Engine</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- =====================================================
       FULL-PAGE AUTH GATE (Login first / Demo option)
  ===================================================== -->
  <div id="authGate" class="auth-gate">
    <div class="auth-card">
      <div class="auth-brand">
        <div class="auth-brand-dot"></div>
        <div>
          <div class="auth-title">Welcome Back!</div>
          <div class="auth-subtitle">Sign in to your account</div>
        </div>
      </div>

      <div class="auth-form">
        <label class="auth-field">
          <div class="auth-label">Your Email</div>
          <input id="authEmail" class="auth-input" type="email" placeholder="name@email.com" autocomplete="email" />
        </label>

        <label class="auth-field">
          <div class="auth-label">Password</div>
          <div class="auth-password-wrap">
            <input id="authPassword" class="auth-input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
            <button id="authTogglePw" class="auth-eye" type="button" aria-label="Toggle password">üëÅ</button>
          </div>
        </label>

        <div class="auth-row">
          <label class="auth-remember">
            <input id="authRemember" type="checkbox" checked />
            <span>Remember Me</span>
          </label>

          <button id="authForgot" class="auth-link" type="button">Forgot Password?</button>
        </div>

        <button id="authLoginBtn" class="auth-primary" type="button">Login</button>

        <div class="auth-divider">
          <span>or</span>
        </div>

        <button id="authDemoBtn" class="auth-secondary" type="button">Demo Environment</button>

        <div id="authGateMsg" class="auth-msg"></div>
      </div>
    </div>
  </div>
  
  <!-- Top Header / Nav -->
  <header class="app-header">
    <!-- Left: Brand -->
    <div class="app-header-left">
      <div class="brand">
        <span class="brand-dot" aria-hidden="true"></span>
        <span class="brand-text">
          <span class="brand-title">Cupp Health Solutions: Assignment Engine</span>
          <span class="brand-subtitle">Created by Zachary Cupp, BSN, RN</span>
        </span>
      </div>
    </div>

    <button class="tabButton" type="button" onclick="window.assignmentQuality && window.assignmentQuality.open()">
      Assignment Quality Index
    </button>
    
    <!-- Middle: Tabs (UPDATED ORDER) -->
    <nav class="header-nav top-tabs" aria-label="Primary">
      <button class="tabButton header-tab" data-target="environmentTab">Environment</button>
      <button class="tabButton active header-tab" data-target="staffingTab">Staffing Details</button>
      <button class="tabButton header-tab" data-target="patientDetailsTab">Patient Details</button>
      <button class="tabButton header-tab" data-target="highRiskTab">High Risk Report</button>
      <button class="tabButton header-tab" data-target="liveAssignmentTab">LIVE Assignment</button>
      <button class="tabButton header-tab" data-target="oncomingAssignmentTab">Oncoming Assignment</button>
      <button class="tabButton header-tab" data-target="unitPulseTab">Unit Pulse</button>
    </nav>

    <!-- Right: Unit Switch + Compact Auth Menu -->
    <div class="header-right">
      <!-- Minimal unit switcher hook (wired in JS) -->
      <div class="unit-switcher" style="display:flex; align-items:center; gap:8px; margin-right:10px;">
        <span style="font-size:12px; opacity:0.75;">Unit</span>
        <select id="unitSwitcher" style="max-width:220px;">
          <option value="">‚Äî</option>
        </select>
      </div>

      <div id="authMenu" class="auth-menu">
        <button id="authMenuBtn" class="auth-menu-btn" type="button" aria-haspopup="menu" aria-expanded="false" title="Account">
          <span class="auth-avatar" aria-hidden="true">üë§</span>
        </button>

        <div id="authDropdown" class="auth-dropdown" role="menu" aria-label="Account menu">
          <div class="auth-dropdown-header">
            <div id="authStatus" class="auth-status">Auth: ‚Ä¶</div>
            <button id="authDropdownClose" class="auth-x" type="button" aria-label="Close">‚úï</button>
          </div>

          <!-- Signed out -->
          <div id="authLoggedOut" class="auth-block" style="display:none;">
            <label class="auth-label" for="authMenuEmail">Email</label>
            <input id="authMenuEmail" type="email" placeholder="you@domain.com" class="auth-input">

            <label class="auth-label" for="authMenuPassword" style="margin-top:8px;">Password</label>
            <input id="authMenuPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="auth-input" autocomplete="current-password">

            <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
              <button id="btnSignInPassword" class="auth-primary-btn" type="button">Sign in</button>
              <button id="btnSignUpPassword" class="auth-secondary-btn" type="button">Sign up</button>
              <button id="btnMagicLink" class="auth-ghost-btn" type="button">Magic link</button>
            </div>

            <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
              <button id="btnResetPassword" class="auth-ghost-btn" type="button">Set / Reset password</button>
            </div>

            <div style="margin-top:8px; font-size:12px; opacity:0.75; line-height:1.3;">
              Tip: If you originally used magic link, click <strong>Set / Reset password</strong> once to create a password for the same account.
            </div>
          </div>

          <!-- ‚úÖ Password Recovery / Set New Password (shows when recovery link is opened) -->
          <div id="authRecovery" class="auth-block" style="display:none; margin-top:10px;">
            <div style="font-weight:800; font-size:13px; color:#0f172a;">Set New Password</div>

            <label class="auth-label" for="authNewPassword">New password</label>
            <input id="authNewPassword" type="password" class="auth-input" placeholder="At least 8 characters" autocomplete="new-password">

            <label class="auth-label" for="authNewPassword2">Confirm new password</label>
            <input id="authNewPassword2" type="password" class="auth-input" placeholder="Repeat new password" autocomplete="new-password">

            <button id="btnSetNewPassword" class="auth-primary-btn" type="button">Save new password</button>

            <div style="font-size:12px; opacity:0.75; line-height:1.3;">
              After saving, you can sign in normally using email + password.
            </div>
          </div>

          <!-- Signed in -->
          <div id="authLoggedIn" class="auth-block" style="display:none;">
            <div class="auth-userline">
              <div class="auth-useremail" id="authUserEmail"></div>
              <div class="auth-pill" id="authUnitRole">unit: ‚Äî | role: ‚Äî</div>
            </div>
            <button id="btnSignOut" class="auth-danger-btn" type="button">Sign out</button>
          </div>

          <div id="authMsg" class="auth-msg"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="main-container">

    <!-- ENVIRONMENT TAB (NEW) -->
    <section id="environmentTab" class="tab-section" style="display: none;">
      <h1>Environment</h1>
      <p>
        Unit-scoped settings live here. Selecting a unit here should populate settings across all tabs.
      </p>

      <div class="staff-card">
        <div class="staff-card-header">Active Unit (Settings Scope)</div>

        <div class="staff-inline-controls" style="gap:10px; flex-wrap:wrap;">
          <label for="envUnitSelect"><strong>Unit:</strong></label>
          <select id="envUnitSelect" style="min-width: 240px;">
            <option value="">‚Äî Select a unit ‚Äî</option>
          </select>

          <button id="btnEnvMakeActive" type="button">Make Active Unit</button>
        </div>

        <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
          Active unit: <strong id="envActiveUnitLabel">‚Äî</strong>
        </div>
      </div>

      <div class="staff-card">
        <div class="staff-card-header">Seed / Test Environment</div>

        <div style="font-size:14px; color:#475569; line-height:1.4; margin-bottom:10px;">
          Create standard demo units + settings in Supabase for quick investor demos.
        </div>

        <div class="actions-row" style="flex-wrap:wrap;">
          <button id="btnSeed2South32" type="button">Seed: 2 South (200A‚Äì221B)</button>
          <button id="btnSeed2SouthOverflow" type="button" disabled title="Coming soon">Seed: 2 South + Overflow</button>
        </div>

        <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
          Note: seeding requires you to be an owner/admin in the target unit(s) based on RLS.
        </div>
      </div>

      <div class="staff-card">
        <div class="staff-card-header">Loaded Unit Settings (Preview)</div>
        <div style="font-size:12px; opacity:0.8; margin-bottom:8px;">
          This is the current <code>unit_settings</code> payload loaded for the active unit.
        </div>
        <pre id="envSettingsPreview" style="white-space:pre-wrap; font-size:12px; background:#0b1220; color:#e5e7eb; padding:12px; border-radius:10px; overflow:auto; max-height:320px;">{}</pre>
      </div>

      <div class="staff-card">
        <div class="staff-card-header">Notes</div>
        <div style="font-size:14px; color:#475569; line-height:1.4;">
          Add environment metrics here (staffing strain, bed status, holds, throughput, etc.).
        </div>
      </div>
    </section>

    <!-- STAFFING TAB -->
    <section id="staffingTab" class="tab-section" style="display: block;">
      <h1>Staffing Details</h1>

      <div class="staffing-three-column">
        <!-- LEFT COLUMN: Leadership Team -->
        <div class="staff-column staff-column--support">
          <h2>Leadership Team</h2>

          <div class="staff-card leadership-card">
            <div class="staff-role-row">
              <label for="currentChargeName"><strong>Current Charge:</strong></label>
              <input id="currentChargeName" type="text" placeholder="Name" />
            </div>

            <div class="staff-role-row">
              <label for="currentMentorName"><strong>Current Clinical Mentor:</strong></label>
              <input id="currentMentorName" type="text" placeholder="Name" />
            </div>

            <div class="staff-role-row">
              <label for="currentCtaName"><strong>Current CTA:</strong></label>
              <input id="currentCtaName" type="text" placeholder="Name" />
            </div>

            <hr class="leadership-divider" />

            <div class="staff-role-row">
              <label for="incomingChargeName"><strong>Oncoming Charge:</strong></label>
              <input id="incomingChargeName" type="text" placeholder="Name" />
            </div>

            <div class="staff-role-row">
              <label for="incomingMentorName"><strong>Oncoming Clinical Mentor:</strong></label>
              <input id="incomingMentorName" type="text" placeholder="Name" />
            </div>

            <div class="staff-role-row">
              <label for="incomingCtaName"><strong>Oncoming CTA:</strong></label>
              <input id="incomingCtaName" type="text" placeholder="Name" />
            </div>
          </div>
        </div>

        <!-- MIDDLE COLUMN: Current Shift (existing) -->
        <div class="staff-column">
          <h2>Current Shift</h2>

          <div class="staff-card">
            <div class="staff-card-header">Current RNs</div>
            <div class="staff-inline-controls">
              <label for="currentNurseCount">Current RNs:</label>
              <select id="currentNurseCount">
                <option>1</option><option>2</option><option>3</option><option>4</option>
                <option>5</option><option>6</option><option>7</option><option>8</option>
              </select>
              <button onclick="setupCurrentNurses()">Update Current RNs</button>
            </div>
            <div class="staff-subtitle">Current RN List</div>
            <div id="currentNurseList" class="staffList"></div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Current PCAs</div>
            <div class="staff-inline-controls">
              <label for="pcaShift">PCA Shift:</label>
              <select id="pcaShift" onchange="updatePcaShift(this.value)">
                <option value="day">Day</option>
                <option value="night">Night</option>
              </select>

              <span>Current PCAs:</span>
              <select id="currentPcaCount">
                <option>1</option><option>2</option><option>3</option>
                <option>4</option><option>5</option><option>6</option>
              </select>
              <button onclick="setupCurrentPcas()">Update Current PCAs</button>
            </div>
            <div class="staff-subtitle">Current PCA List</div>
            <div id="currentPcaList" class="staffList"></div>
          </div>
        </div>

        <!-- RIGHT COLUMN: Oncoming Shift (existing) -->
        <div class="staff-column">
          <h2>Oncoming Shift</h2>

          <div class="staff-card">
            <div class="staff-card-header">Oncoming RNs</div>
            <div class="staff-inline-controls">
              <label for="incomingNurseCount">Oncoming RNs:</label>
              <select id="incomingNurseCount">
                <option>1</option><option>2</option><option>3</option><option>4</option>
                <option>5</option><option>6</option><option>7</option><option>8</option>
              </select>
              <button onclick="setupIncomingNurses()">Update Oncoming RNs</button>
            </div>
            <div class="staff-subtitle">Oncoming RN List</div>
            <div id="incomingNurseList" class="staffList"></div>
          </div>

          <div class="staff-card">
            <div class="staff-card-header">Oncoming PCAs</div>
            <div class="staff-inline-controls">
              <label for="incomingPcaCount">Oncoming PCAs:</label>
              <select id="incomingPcaCount">
                <option>1</option><option>2</option><option>3</option>
                <option>4</option><option>5</option><option>6</option>
              </select>
              <button onclick="setupIncomingPcas()">Update Oncoming PCAs</button>
            </div>
            <div class="staff-subtitle">Oncoming PCA List</div>
            <div id="incomingPcaList" class="staffList"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- PATIENT DETAILS TAB -->
    <section id="patientDetailsTab" class="tab-section" style="display: none;">
      <h1>Patient Details</h1>
      <p>
        This grid shows all 32 rooms. Use the controls to set acuity tags and gender
        for each patient. These tags feed both the LIVE and Oncoming Assignment engines.
      </p>

      <div class="actions-row">
        <button onclick="renderPatientList()">Refresh Patient Grid</button>
        <button onclick="resetAllPatients()">Reset All Patients</button>
      </div>

      <div id="patientList" class="patient-grid"></div>
    </section>

    <!-- HIGH RISK TAB -->
    <section id="highRiskTab" class="tab-section" style="display: none;">
      <h1>High Risk Report</h1>
      <p>
        Summary of key acuity tags across all active patients. Use this for quick
        situational awareness and handoff.
      </p>

      <div class="actions-row">
        <button onclick="updateAcuityTiles()">Refresh High Risk Report</button>
        <button onclick="openAcuityModal()">Open Full Acuity Modal</button>
      </div>

      <div id="acuityTiles" class="acuity-tiles-container"></div>
    </section>

    <!-- LIVE ASSIGNMENT TAB -->
    <section id="liveAssignmentTab" class="tab-section" style="display: none;">
      <h1>Live Assignment</h1>

      <div class="actions-row">
        <button onclick="window.populateLiveAssignment(false)">Populate Live Assignment</button>
      </div>

      <div class="live-layout live-layout--rn-with-queue">
        <div class="live-column live-column--rn">
          <h2>Current RN Assignments</h2>
          <div id="liveNurseAssignments" class="assignment-grid live-grid live-grid-nurse"></div>
        </div>

        <div class="live-column live-column--queue">
          <h2>Admit Queue</h2>

          <div class="actions-row">
            <button onclick="promptAddAdmit()">+ Add Admit</button>
          </div>

          <div id="queueList" class="queue-list queue-list--compact"></div>
        </div>
      </div>

      <div class="live-layout live-layout--pca-only" style="margin-top: 16px;">
        <div class="live-column">
          <h2>Current PCA Assignments</h2>
          <div id="livePcaAssignments" class="assignment-grid live-grid live-grid-pca"></div>
        </div>
      </div>
    </section>

    <!-- ONCOMING ASSIGNMENT TAB -->
    <section id="oncomingAssignmentTab" class="tab-section" style="display: none;">
      <h1>Oncoming Assignment (Incoming Staff)</h1>

      <div class="actions-row" style="flex-wrap:wrap;">
        <button onclick="populateOncomingAssignment()">Populate Oncoming Assignment</button>
        <button onclick="rebalanceOncomingAssignment()">Re-generate / Rebalance</button>

        <button id="btnFinalizeShift" type="button" title="Publishes Oncoming snapshot + analytics, then swaps Live ‚Üê Oncoming">
          Finalize / Submit Shift Change
        </button>
      </div>

      <div class="staff-card" style="margin-top: 12px;">
        <div class="staff-card-header">Finalize Details</div>
        <div class="staff-inline-controls" style="gap:10px; flex-wrap:wrap;">
          <label for="finalizeShiftDate"><strong>Shift date:</strong></label>
          <input id="finalizeShiftDate" type="date" />

          <label for="finalizeShiftType"><strong>Shift type:</strong></label>
          <select id="finalizeShiftType">
            <option value="day">Day</option>
            <option value="night">Night</option>
          </select>

          <div style="font-size:12px; opacity:0.75;">
            (Charge/Admin/Owner only)
          </div>
        </div>

        <div id="finalizeStatusMsg" style="margin-top:10px; font-size:12px; opacity:0.85;"></div>
      </div>

      <h2>Incoming RN Assignments</h2>
      <div id="assignmentOutput" class="assignment-grid two-column-grid"></div>

      <h2 style="margin-top: 24px;">Incoming PCA Assignments</h2>
      <div id="pcaAssignmentOutput" class="assignment-grid two-column-grid"></div>
    </section>

    <!-- UNIT PULSE TAB -->
    <section id="unitPulseTab" class="tab-section" style="display: none;">
      <h1>Unit Pulse</h1>
      <p>
        Pulls unit-scoped shift metrics from Supabase and displays trends.
      </p>

      <div class="staff-card">
        <div class="staff-card-header">Query Controls</div>

        <div class="staff-inline-controls" style="gap:10px; flex-wrap:wrap;">
          <label for="pulseFrom"><strong>From:</strong></label>
          <input id="pulseFrom" type="date" />

          <label for="pulseTo"><strong>To:</strong></label>
          <input id="pulseTo" type="date" />

          <label for="pulseShiftType"><strong>Shift:</strong></label>
          <select id="pulseShiftType">
            <option value="">All</option>
            <option value="day">Day</option>
            <option value="night">Night</option>
          </select>

          <button id="btnLoadPulse" type="button">Load Pulse</button>
        </div>

        <div id="pulseStatusMsg" style="margin-top:10px; font-size:12px; opacity:0.85;"></div>
      </div>

      <div class="staff-card">
        <div class="staff-card-header">Pulse Summary</div>
        <div id="pulseSummary" style="font-size:14px; color:#475569; line-height:1.4;">
          No data loaded yet.
        </div>
      </div>

      <div class="staff-card">
        <div class="staff-card-header">Metrics (Table)</div>
        <div id="pulseTable" style="overflow:auto;"></div>
      </div>
    </section>

  </main>

  <!-- MODALS -->
  <div id="patientProfileModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="profileModalTitle">Patient Profile</span>
        <button class="close-btn" onclick="closePatientProfileModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-row">
          <label for="profGender"><strong>Gender:</strong></label>
          <select id="profGender">
            <option value="">-</option>
            <option value="F">F</option>
            <option value="M">M</option>
            <option value="X">X</option>
          </select>
        </div>

        <div class="modal-grid">
          <div class="modal-column">
            <h3>RN Acuity Tags</h3>
            <label><input type="checkbox" id="profTele" /> Tele</label>
            <label><input type="checkbox" id="profDrip" /> Drip</label>
            <label><input type="checkbox" id="profNih" /> NIH</label>
            <label><input type="checkbox" id="profBg" /> BG</label>
            <label><input type="checkbox" id="profCiwa" /> CIWA/COWS</label>
            <label><input type="checkbox" id="profRestraint" /> Restraint</label>
            <label><input type="checkbox" id="profSitter" /> Sitter</label>
            <label><input type="checkbox" id="profVpo" /> VPO</label>
            <label><input type="checkbox" id="profIso" /> Isolation</label>
            <label><input type="checkbox" id="profAdmit" /> Admit</label>
            <label><input type="checkbox" id="profLateDc" /> Late DC</label>
          </div>

          <div class="modal-column">
            <h3>PCA Acuity Tags</h3>
            <label><input type="checkbox" id="profTelePca" /> Tele</label>
            <label><input type="checkbox" id="profIsoPca" /> Isolation</label>
            <label><input type="checkbox" id="profAdmitPca" /> Admit</label>
            <label><input type="checkbox" id="profLateDcPca" /> Late DC</label>
            <label><input type="checkbox" id="profChg" /> CHG</label>
            <label><input type="checkbox" id="profFoley" /> Foley</label>
            <label><input type="checkbox" id="profQ2" /> Q2 Turns</label>
            <label><input type="checkbox" id="profHeavy" /> Heavy</label>
            <label><input type="checkbox" id="profFeeder" /> Feeder</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="savePatientProfile()">Save</button>
        <button onclick="closePatientProfileModal()">Cancel</button>
      </div>
    </div>
  </div>

  <div id="dischargeHistoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>Discharge History (This Session)</span>
        <button class="close-btn" onclick="closeDischargeHistoryModal()">&times;</button>
      </div>
      <div class="modal-body" id="dischargeHistoryBody"></div>
    </div>
  </div>

  <div id="acuityModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>High Acuity Summary</span>
        <button class="close-btn" onclick="closeAcuityModal()">&times;</button>
      </div>
      <div class="modal-body" id="acuityReportBody"></div>
    </div>
  </div>

  <!-- ASSIGN ADMIT MODAL -->
  <div id="queueAssignModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>Assign Admit to RN / PCA</span>
        <button class="close-btn" onclick="closeQueueAssignModal()">&times;</button>
      </div>

      <div class="modal-body">
        <p id="queueAssignInfo" style="margin-bottom: 12px; font-size: 14px; opacity: 0.8;">
          Select the receiving RN, PCA, and the empty bed for this admit.
        </p>

        <div class="modal-row">
          <label for="queueAssignBed"><strong>Receiving Bed (Empty):</strong></label>
          <select id="queueAssignBed"></select>
        </div>

        <div class="modal-row">
          <label for="queueAssignNurse"><strong>Receiving RN:</strong></label>
          <select id="queueAssignNurse"></select>
        </div>

        <div class="modal-row">
          <label for="queueAssignPca"><strong>Receiving PCA:</strong></label>
          <select id="queueAssignPca"></select>
        </div>

        <p style="font-size: 12px; opacity: 0.7; margin-top: 8px;">
          Tip: if you don‚Äôt see the bed you expect, make sure the room is marked empty in Patient Details or by discharge.
        </p>
      </div>

      <div class="modal-footer">
        <button onclick="confirmQueueAssign()">Assign</button>
        <button onclick="closeQueueAssignModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- PRE-ADMIT TAGS MODAL -->
  <div id="admitDraftModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="admitDraftTitle">Pre-Admit Tags</span>
        <button class="close-btn" onclick="closeAdmitDraftModal()">&times;</button>
      </div>

      <div class="modal-body">
        <p id="admitDraftInfo" style="margin-bottom: 12px; font-size: 14px; opacity: 0.85;">
          Set optional pre-admit tags. These will copy into the patient record when you assign this admit into a bed.
        </p>

        <div class="modal-row">
          <label for="admitDraftGender"><strong>Gender (optional):</strong></label>
          <select id="admitDraftGender">
            <option value="">-</option>
            <option value="F">F</option>
            <option value="M">M</option>
            <option value="X">X</option>
          </select>
        </div>

        <div class="modal-grid" style="margin-top: 12px;">
          <div class="modal-column">
            <h3>RN Pre-Admit Tags</h3>
            <label><input type="checkbox" id="adTele" /> Tele</label>
            <label><input type="checkbox" id="adDrip" /> Drip</label>
            <label><input type="checkbox" id="adNih" /> NIH</label>
            <label><input type="checkbox" id="adBg" /> BG</label>
            <label><input type="checkbox" id="adCiwa" /> CIWA/COWS</label>
            <label><input type="checkbox" id="adRestraint" /> Restraint</label>
            <label><input type="checkbox" id="adSitter" /> Sitter</label>
            <label><input type="checkbox" id="adVpo" /> VPO</label>
            <label><input type="checkbox" id="adIso" /> Isolation</label>
            <label><input type="checkbox" id="adLateDc" /> Late DC</label>
          </div>

          <div class="modal-column">
            <h3>PCA Pre-Admit Tags</h3>
            <label><input type="checkbox" id="adChg" /> CHG</label>
            <label><input type="checkbox" id="adFoley" /> Foley</label>
            <label><input type="checkbox" id="adQ2" /> Q2 Turns</label>
            <label><input type="checkbox" id="adHeavy" /> Heavy</label>
            <label><input type="checkbox" id="adFeeder" /> Feeder</label>
          </div>
        </div>

        <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
          Note: ‚ÄúAdmit‚Äù itself is automatically set when the admit is placed into a bed.
        </p>
      </div>

      <div class="modal-footer">
        <button onclick="saveAdmitDraftFromModal()">Save Tags</button>
        <button onclick="closeAdmitDraftModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Assignment Quality Index Modal -->
  <div id="aqiModal" class="modal" style="display:none;">
    <div id="aqiPanel" class="modal-content aqi-panel">
      <div id="aqiDragHandle" class="aqi-header">
        <div>
          <div class="aqi-title">Assignment Quality Index</div>
          <div class="aqi-subtitle">Hard rules + report sources + hallway comfort</div>
        </div>
        <button id="aqiClose" class="aqi-x" type="button">‚úï</button>
      </div>

      <div id="aqiBody" class="aqi-body"></div>
    </div>
  </div>
  
  <script src="app/app.state.js"></script>
  <script src="app/app.queue.js"></script>
  <script src="app/app.staffing.js"></script>
  <script src="app/app.patientsAcuity.js"></script>
  <script src="app/app.assignmentsDrag.js"></script>
  <script src="app/app.assignmentRules.js"></script>
 
  <script src="app/app.explanations.js"></script>
  
  <script src="app/app.liveAssignments.js"></script>
  <script src="app/app.assignmentsrender.js"></script>
  <script src="app/app.modals.js"></script>

  <!-- ‚úÖ Supabase library FIRST -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <!-- ‚úÖ then your config + wrapper + auth -->
  <script src="app/app.supabaseConfig.js"></script>
  <script src="app/app.supabase.js"></script>
  <script src="app/app.authUI.js"></script>

  <script src="app/app.authGate.js"></script>
  <script src="app/app.assignmentQuality.js"></script>

  <!-- ‚úÖ shift change (logic), then init -->
  <script src="app/app.shiftChange.js"></script>
  <script src="app/app.init.js"></script>

  <script src="app/app.patientProfileUI.js"></script>

  <!-- Keep LAST so it can hook up handlers after DOM exists -->
  <script src="script.js"></script>
</body>
</html>